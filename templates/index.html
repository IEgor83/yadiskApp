<!-- templates/disk_viewer/index.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .file-list {
            margin-top: 20px;
        }
        .file-list ul {
            list-style-type: none;
            padding: 0;
        }
        .file-list li {
            margin: 5px 0;
        }
        .file-list li a {
            text-decoration: none;
            color: blue;
        }
    </style>
</head>
<body>
    <h1>–ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞</h1>
    <form method="post">
        {% csrf_token %}
        <input type="text" name="public_key" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á" value="{{ public_key }}" required>
        <button type="submit">–ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∞–π–ª—ã</button>
    </form>

    <div class="filter" style="margin-top: 15px;">
        <label for="file_type_filter">–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É:</label>
        <select id="file_type_filter">
            <option value="all">–í—Å–µ</option>
            {% for mime_type, files in categorized_files.items %}
                <option value="{{ mime_type }}">{{ mime_type }}</option>
            {% endfor %}
        </select>
    </div>

    {% if files %}
        <div class="file-list">
            <h2>–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫:</h2>
            <ul id="file_list">
                {% for file in files %}
                    <li data-mime-type="{{ file.mime_type|default:'unknown' }}">
                        {% if file.type == 'dir' %}
                            üìÅ {{ file.name }}
                        {% elif file.type == 'file' %}
                            üìÑ {{ file.name }}
                            <a href="{{ file.file }}" target="_blank">–°–∫–∞—á–∞—Ç—å</a>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% elif public_key %}
        <p>–§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.</p>
    {% endif %}

    <script>
        document.getElementById('file_type_filter').addEventListener('change', function () {
            const selectedType = this.value;
            const files = document.querySelectorAll('#file_list li');

            files.forEach(file => {
                const fileType = file.getAttribute('data-mime-type');
                if (selectedType === 'all' || fileType === selectedType) {
                    file.style.display = '';
                } else {
                    file.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
